# Commands

Clients send commands and receive events.

Following are the commands and events:

## Iam = "i"

`Iam(signature: string, pubkey: string)` - authenticates the client to the server by signing a challenge posed via the `Who` event.

- `pubkey` is the Libsodium public key generated by [`crypto_sign_keypair`](https://libsodium.gitbook.io/doc/public-key_cryptography/public-key_signatures)
- `signature` is the Libsodium signature generated by [`crypto_sign_detached`](https://libsodium.gitbook.io/doc/public-key_cryptography/public-key_signatures)

A successful authentication will cause the `Authenticated` event to be emitted.

An `Error` event is sent if there's a problem.

## Connect = "c"

`Connect(conn_pubkey: string)` - asks relay server to connect this client to another remote client identified by the given public key.  Two clients become connected when both have requested to connect to the other.

- `conn_pubkey` is the public key of the client to connect to

Successful connection will be indicated with the `Connected` event.

An `Error` event is sent if there's a problem.

## Disconnect = "x"

`Disconnect(dcon_id: int)` - disconnects a single client-to-client connection while still retaining all other client-to-client connections.

- `dcon_id` is the connection id received from the `Connected` event

Successful disconnection will be indicated with the `Disconnected` event.

An `Error` event is sent if there's a problem.

## SendData = "d"

`SendData(send_id: int, send_data: string)` - sends some bytes to a connected client.

- `send_id` is the connection id received from the `Connected` event
- `send_data` is the data to send to the other client

An `Error` event is sent if there's a problem.

## Events

## Who = "?"

`Who(who_challenge: string)` is emitted by the server to initiate authentication. Use the `Iam` command to authenticate.

## Authenticated = "+"

`Authenticated` is emitted once the client has successfully authenticated.

## Connected = "c"

`Connected(conn_pubkey: string, conn_id: int)` is emitted when this client has connected to a remote client.

- `conn_pubkey` is the remote client's public key
- `conn_id` is used to identify this connection in future commands and events

## Disconnected = "x"

`Disconnected(dcon_pubkey: string, dcon_id: int)` is emitted when a connection is disconnected.

- `dcon_pubkey` is the remote client's public key
- `dcon_id` is the `conn_id` from the `Connected` event

## Data = "d"

`Data(sender_id: int, data: string)` is emitted when a remote client sends data.

- `sender_id` is the `conn_id` from the `Connected` event
- `data` is the string of bytes sent from the remote client
  
## ErrorEvent = "E"

`ErrorEvent(err_message: string)` is emitted when there are errors.

- `err_message` is a string description of the error


# Development

Run the tests:

  nimble test
